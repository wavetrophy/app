Added password authentication and fixed some bugs